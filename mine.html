<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ðŸ’£ JacksMines ðŸ’£</title>
<style>
body{margin:0;background:black;color:white;font-family:monospace;display:flex;flex-direction:column;align-items:center}
h1{margin:10px 0}
table{border-collapse:collapse;margin-top:20px}
td{width:35px;height:35px;background:#555;border:1px solid #333;text-align:center;vertical-align:middle;font-size:16px;cursor:pointer}
td.revealed{background:#aaa;cursor:default}
td.mine{background:red}
select,button{margin-top:10px;padding:5px 10px;font-size:1rem;cursor:pointer}
#status{margin-top:8px}
</style>
</head>
<body>
<h1>ðŸ’£ JacksMines ðŸ’£</h1>
<label>Grid size:</label>
<select id="size"><option>5</option><option>10</option><option>20</option><option>32</option></select>
<button id="reset">Reset</button>
<table id="board"></table>
<p id="status"></p>
<script>
let board=[],mines=3,size=5,gameOver=false,firstClick=true;
const t=document.getElementById("board"),st=document.getElementById("status"),sz=document.getElementById("size"),rst=document.getElementById("reset");

function r(n){return Math.floor(Math.random()*n)}

function init(){
  board=[];gameOver=false;firstClick=true;
  size=parseInt(sz.value);
  mines=size===5?3:size===10?15:size===20?60:150;
  t.innerHTML="";st.textContent="";
  for(let i=0;i<size;i++){
    const tr=document.createElement("tr"),row=[];
    for(let j=0;j<size;j++){
      const td=document.createElement("td");
      td.onclick=()=>reveal(i,j,true);
      td.oncontextmenu=e=>{e.preventDefault();flag(i,j)};
      tr.appendChild(td);
      row.push({mine:false,revealed:false,flagged:false,td});
    }
    t.appendChild(tr);board.push(row);
  }
}

function placeMines(excludeR,excludeC){
  let minesSet=new Set();
  while(minesSet.size<mines){
    let r1=r(size),c1=r(size);
    if(Math.abs(r1-excludeR)<=1 && Math.abs(c1-excludeC)<=1) continue;
    minesSet.add(r1+","+c1);
  }
  for(let m of minesSet){
    let [x,y]=m.split(",").map(Number);
    board[x][y].mine=true;
  }
}

function count(r,c){let n=0;for(let i=-1;i<=1;i++)for(let j=-1;j<=1;j++)if(board[r+i]?.[c+j]?.mine)n++;return n}

function reveal(r,c,isFirst=false){
  if(gameOver) return;
  const cell=board[r][c]; if(cell.revealed||cell.flagged) return;
  if(firstClick&&isFirst){placeMines(r,c);firstClick=false}
  cell.revealed=true;
  if(cell.mine){cell.td.className="mine";cell.td.textContent="ðŸ’£";st.textContent="Game Over!";gameOver=true;board.flat().filter(x=>x.mine).forEach(x=>{x.td.textContent="ðŸ’£";x.td.className="mine"});return}
  let n=count(r,c); cell.td.textContent=n?n:""; cell.td.className="revealed";
  if(n===0)for(let i=-1;i<=1;i++)for(let j=-1;j<=1;j++)if(board[r+i]?.[c+j])reveal(r+i,c+j);
  if(board.flat().filter(x=>x.revealed).length===size*size-mines){st.textContent="You Win!";gameOver=true}
}

function flag(r,c){if(gameOver) return;const cell=board[r][c];if(cell.revealed) return;cell.flagged=!cell.flagged;cell.td.textContent=cell.flagged?"ðŸš©":""}

rst.onclick=init; sz.onchange=init; init();
</script>
</body>
</html>
