<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>JackBlack Multiplayer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #1e1e1e;
      color: white;
      margin: 0;
      padding: 0;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #333;
      padding: 20px;
    }
    header h1 {
      margin: 0;
      font-size: 24px;
    }
    #player-info {
      font-size: 18px;
    }
    main {
      padding: 40px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #controls {
      margin: 20px 0;
    }
    button {
      padding: 15px 30px;
      font-size: 18px;
      margin: 10px;
      cursor: pointer;
    }
    #player-cards, #dealer-cards {
      display: flex;
      justify-content: center;
      align-items: center;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    .card {
      display: inline-block;
      margin: 10px;
      padding: 20px 25px;
      background-color: #f0f0f0;
      border-radius: 10px;
      color: black;
      font-size: 24px;
    }
    #game-message {
      margin-top: 30px;
      font-size: 20px;
      text-align: center;
    }
    input {
      padding: 10px;
      font-size: 16px;
      margin-right: 10px;
    }
  </style>
</head>
<body>
  <header>
    <h1>JackBlack Multiplayer</h1>
    <div id="player-info"></div>
  </header>
  <main>
    <p>Join a room to play blackjack in real-time!</p>
    <div>
      <input id="room-id" placeholder="Enter Room ID" />
      <button id="join-room-button" onclick="joinRoom()">Join Room</button>
    </div>

    <div id="controls" style="display:none;">
      <button id="vote-button" onclick="voteToStart()">Vote to Start</button>
      <button id="hit-button" onclick="hit()" style="display:none;">Hit</button>
      <button id="stand-button" onclick="stand()" style="display:none;">Stand</button>
    </div>

    <div>
      <h2>Your Cards</h2>
      <div id="player-cards"></div>
    </div>
    <div>
      <h2>Dealer's Cards</h2>
      <div id="dealer-cards"></div>
    </div>
    <div id="game-message"></div>
  </main>

  <!-- Firebase scripts -->
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
     apiKey: "AIzaSyBVajydbsrNT6bJOCNMNjJZc4NXvGy42SQ",

  authDomain: "jackblack-789f5.firebaseapp.com",

  databaseURL: "https://jackblack-789f5-default-rtdb.firebaseio.com",

  projectId: "jackblack-789f5",

  storageBucket: "jackblack-789f5.firebasestorage.app",

  messagingSenderId: "14557094808",

  appId: "1:14557094808:web:252134996948616d95c1ed",

    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let roomId = "";
    let playerId = "player" + Math.floor(Math.random() * 1000);
    let isPlayerTurn = false;
    let maxPlayers = 2;

    function joinRoom() {
      roomId = document.getElementById("room-id").value.trim();
      if (!roomId) return alert("Enter room ID!");
      const roomRef = db.ref(`rooms/${roomId}`);

      roomRef.once('value', snap => {
        const roomData = snap.val();
        if (roomData && roomData.players && Object.keys(roomData.players).length >= maxPlayers) {
          alert("Room is full! Cannot join.");
          return;
        }

        const playerRef = db.ref(`rooms/${roomId}/players/${playerId}`);
        playerRef.set({ joined: Date.now(), vote: false });
        playerRef.onDisconnect().remove();

        document.getElementById("player-info").innerText = `You are ${playerId}`;
        document.getElementById("controls").style.display = "block";
        listenForUpdates();
        listenForGameUpdates();
      });
    }

    function listenForUpdates() {
      db.ref(`rooms/${roomId}/players`).on('value', snap => {
        const players = snap.val();
        if (!players) return;

        let votes = 0;
        let totalPlayers = 0;
        for (let pid in players) {
          totalPlayers++;
          if (players[pid].vote) votes++;
        }

        document.getElementById("game-message").innerText = `${votes} out of ${totalPlayers} voted to start.`;

        if (votes === maxPlayers) {
          startGame();
        }
      });
    }

    function voteToStart() {
      const playerRef = db.ref(`rooms/${roomId}/players/${playerId}`);
      playerRef.update({ vote: true });
    }

    function startGame() {
      const suits = ['♠', '♣', '♦', '♥'];
      const values = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
      let deck = [];
      for (let s of suits) for (let v of values) deck.push({ v, s });
      deck = deck.sort(() => Math.random() - 0.5);

      const gameState = {
        deck,
        playerHands: {},
        dealerHand: [deck.pop(), deck.pop()],
        turn: null,
        message: "Game started!",
        over: false,
        playerStand: {}
      };

      db.ref(`rooms/${roomId}/players`).once('value', snap => {
        const players = snap.val();
        const playerIds = Object.keys(players);
        if (playerIds.length < maxPlayers) return;

        gameState.turn = playerIds[0]; // Player 1 starts
        for (let pid of playerIds) {
          gameState.playerHands[pid] = [deck.pop(), deck.pop()];
          gameState.playerStand[pid] = false;
        }

        db.ref(`rooms/${roomId}/game`).set(gameState);
        // Reset votes
        for (let pid of playerIds) {
          db.ref(`rooms/${roomId}/players/${pid}`).update({ vote: false });
        }
      });

      document.getElementById("vote-button").style.display = "none";
    }

    function updateCards(id, cards) {
      const div = document.getElementById(id);
      div.innerHTML = "";
      cards.forEach(card => {
        const el = document.createElement("div");
        el.className = "card";
        el.innerText = `${card.v} ${card.s}`;
        div.appendChild(el);
      });
    }

    function listenForGameUpdates() {
      db.ref(`rooms/${roomId}/game`).on('value', snap => {
        const game = snap.val();
        if (!game) return;

        const playerHand = game.playerHands?.[playerId] || [];
        const dealerHand = game.dealerHand || [];
        isPlayerTurn = game.turn === playerId;

        updateCards("player-cards", playerHand);
        updateCards("dealer-cards", game.over ? dealerHand : [dealerHand[0], { v: "??", s: "?" }]);
        document.getElementById("game-message").innerText = game.message || "";

        if (isPlayerTurn && !game.over) {
          document.getElementById("hit-button").style.display = "inline-block";
          document.getElementById("stand-button").style.display = "inline-block";
        } else {
          document.getElementById("hit-button").style.display = "none";
          document.getElementById("stand-button").style.display = "none";
        }

        if (game.over) {
          document.getElementById("vote-button").style.display = "inline-block";
        }
      });
    }

    function hit() {
      db.ref(`rooms/${roomId}/game`).once('value', snap => {
        const game = snap.val();
       
::contentReference[oaicite:0]{index=0}
 
    function hit() {
      db.ref(`rooms/${roomId}/game`).once('value', snap => {
        const game = snap.val();
        if (!game || game.over || game.turn !== playerId) return;

        const deck = game.deck;
        const card = deck.pop();
        const hand = game.playerHands[playerId];
        hand.push(card);

        const total = calculateHandValue(hand);
        let message = `${playerId} hits.`;

        if (total > 21) {
          game.over = true;
          message = `${playerId} busts!`;
        }

        game.deck = deck;
        game.playerHands[playerId] = hand;
        game.message = message;

        if (game.over) {
          game.message += ` ${getOtherPlayerId(game)} wins!`;
        }

        db.ref(`rooms/${roomId}/game`).set(game);
      });
    }

    function stand() {
      db.ref(`rooms/${roomId}/game`).once('value', snap => {
        const game = snap.val();
        if (!game || game.over || game.turn !== playerId) return;

        game.playerStand[playerId] = true;
        let message = `${playerId} stands.`;

        const otherPlayerId = getOtherPlayerId(game);

        if (game.playerStand[otherPlayerId]) {
          // Both players have stood; determine winner
          const playerTotal = calculateHandValue(game.playerHands[playerId]);
          const otherTotal = calculateHandValue(game.playerHands[otherPlayerId]);

          game.over = true;
          if (playerTotal > otherTotal) {
            message = `${playerId} wins!`;
          } else if (playerTotal < otherTotal) {
            message = `${otherPlayerId} wins!`;
          } else {
            message = "It's a tie!";
          }
        } else {
          // Switch turn to the other player
          game.turn = otherPlayerId;
        }

        game.message = message;
        db.ref(`rooms/${roomId}/game`).set(game);
      });
    }

    function calculateHandValue(hand) {
      let total = 0;
      let aces = 0;

      hand.forEach(card => {
        if (['J', 'Q', 'K'].includes(card.v)) {
          total += 10;
        } else if (card.v === 'A') {
          total += 11;
          aces += 1;
        } else {
          total += parseInt(card.v);
        }
      });

      while (total > 21 && aces > 0) {
        total -= 10;
        aces -= 1;
      }

      return total;
    }

    function getOtherPlayerId(game) {
      return Object.keys(game.playerHands).find(pid => pid !== playerId);
    }
  </script>
</body>
</html>
